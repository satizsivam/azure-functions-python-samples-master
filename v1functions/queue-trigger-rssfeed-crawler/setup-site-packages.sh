#!/bin/sh

PIP_COMMNAD="pip"
SITE_PACKAGES_DIR="site-packages"
TMP_DIR="t"
cwd=`dirname "$0"`
expr "$0" : "/.*" > /dev/null || cwd=`(cd "$cwd" && pwd)`

if ! type "$PIP_COMMNAD" > /dev/null; then
    echo "$PIP_COMMNAD command doesn't exist! Please install pip here"
    exit 0
fi

cd $cwd

if [ ! -e $TMP_DIR ]
then
    echo "Creating directory $TMP_DIR"
    mkdir -p $TMP_DIR
fi

echo "Getting all packages that needed for this program...."
pip install --install-option="--prefix=$cwd/$TMP_DIR" feedparser
TARGET_DIR=`find $TMP_DIR -name "$SITE_PACKAGES_DIR"`
mv $TARGET_DIR function/
rm -rf $TMP_DIR
echo "The packages are copied: function/$SITE_PACKAGES_DIR!!"
echo "Please make sure to install $SITE_PACKAGES_DIR along with run.py and function.json"

echo "done!"
exit 0
